<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rebuilt Ã— Picket â€” Financial Model</title>
  <meta name="robots" content="noindex" />
  <!-- No-build stack (CDNs) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    html,body{background:#1a1a1a;color:#e0e0e0;scroll-behavior:smooth}
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    .fade-in{animation:fadeIn 0.4s ease-out}
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}
    .pulsing{animation:pulse 2s ease-in-out 3}
    @keyframes slideIn{from{width:0}to{width:var(--target-width)}}
    .bar-animate{animation:slideIn 1s ease-out forwards}

    /* Dark mode overrides */
    .gradient-card{background:linear-gradient(135deg,#2563eb 0%,#1d4ed8 100%)}
    .gradient-accent{background:linear-gradient(135deg,#0ea5e9 0%,#0284c7 100%)}

    /* Premium Metallic Cyan Sliders - Steel Gray Track */
    input[type="range"]{-webkit-appearance:none;appearance:none;background:transparent;cursor:pointer;width:100%;height:28px;margin:0;padding:0}
    input[type="range"]::-webkit-slider-runnable-track{background:linear-gradient(to right,#4b5563,#6b7280,#9ca3af);height:10px;border-radius:5px;border:1px solid #6b7280;box-shadow:inset 0 1px 2px rgba(0,0,0,0.3),0 0 6px rgba(107,114,128,0.4)}
    input[type="range"]:focus::-webkit-slider-runnable-track{background:linear-gradient(to right,#4b5563,#6b7280,#9ca3af)}
    input[type="range"]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;background:linear-gradient(135deg,#06b6d4,#0ea5e9,#3b82f6);height:22px;width:22px;border-radius:50%;border:1px solid #f0f9ff;box-shadow:0 0 8px rgba(6,182,212,0.8),0 0 16px rgba(14,165,233,0.4),0 2px 4px rgba(0,0,0,0.3);transition:all 0.2s;cursor:grab;margin-top:-6px}
    input[type="range"]::-webkit-slider-thumb:hover{background:linear-gradient(135deg,#22d3ee,#06b6d4,#0ea5e9);transform:scale(1.15);box-shadow:0 0 12px rgba(6,182,212,1),0 0 24px rgba(14,165,233,0.6),0 4px 8px rgba(0,0,0,0.4);border-color:#fff}
    input[type="range"]::-webkit-slider-thumb:active{cursor:grabbing;transform:scale(1.05)}
    input[type="range"]:hover::-webkit-slider-runnable-track{background:linear-gradient(to right,#6b7280,#9ca3af,#d1d5db);box-shadow:inset 0 1px 2px rgba(0,0,0,0.2),0 0 8px rgba(107,114,128,0.6)}
    input[type="range"]::-moz-range-track{background:linear-gradient(to right,#4b5563,#6b7280,#9ca3af);height:10px;border-radius:5px;border:1px solid #6b7280;box-shadow:inset 0 1px 2px rgba(0,0,0,0.3),0 0 6px rgba(107,114,128,0.4)}
    input[type="range"]::-moz-range-thumb{background:linear-gradient(135deg,#06b6d4,#0ea5e9,#3b82f6);height:22px;width:22px;border-radius:50%;border:1px solid #f0f9ff;box-shadow:0 0 8px rgba(6,182,212,0.8),0 0 16px rgba(14,165,233,0.4),0 2px 4px rgba(0,0,0,0.3);transition:all 0.2s;cursor:grab}
    input[type="range"]::-moz-range-thumb:hover{background:linear-gradient(135deg,#22d3ee,#06b6d4,#0ea5e9);transform:scale(1.15);box-shadow:0 0 12px rgba(6,182,212,1),0 0 24px rgba(14,165,233,0.6),0 4px 8px rgba(0,0,0,0.4);border-color:#fff}
    input[type="range"]::-moz-range-thumb:active{cursor:grabbing;transform:scale(1.05)}
    input[type="range"]:hover::-moz-range-track{background:linear-gradient(to right,#6b7280,#9ca3af,#d1d5db);box-shadow:inset 0 1px 2px rgba(0,0,0,0.2),0 0 8px rgba(107,114,128,0.6)}

    /* Dark mode cards */
    .dark-card{background:#2c2c2c;border-color:#404040;box-shadow:0 8px 16px rgba(0,0,0,0.5)}
    .dark-card-header{background:#1f1f1f;border-color:#333}

    /* Enhanced tooltips */
    .tooltip-enhanced{visibility:hidden;background:#1f1f1f;color:#e0e0e0;border-radius:6px;padding:10px;position:absolute;z-index:50;bottom:100%;left:50%;transform:translateX(-50%);width:max-content;max-width:300px;text-align:center;opacity:0;transition:opacity 0.3s,visibility 0.3s;box-shadow:0 4px 12px rgba(0,0,0,0.6);border:1px solid #4da6ff;font-size:0.75rem;line-height:1.4}
    .tooltip-enhanced::after{content:'';position:absolute;top:100%;left:50%;margin-left:-5px;border-width:5px;border-style:solid;border-color:#1f1f1f transparent transparent transparent}
    .has-tooltip:hover .tooltip-enhanced{visibility:visible;opacity:1}

    /* Info icon tooltips */
    .info-icon{display:inline-flex;align-items:center;justify-content:center;width:16px;height:16px;border-radius:50%;background:linear-gradient(135deg,#2563eb,#1d4ed8);color:#fff;font-size:11px;font-weight:bold;margin-left:6px;cursor:help;position:relative;border:1px solid #3b82f6;transition:all 0.2s;flex-shrink:0}
    .info-icon::before{content:'i';display:block}
    .info-icon:hover{background:linear-gradient(135deg,#3b82f6,#2563eb);transform:scale(1.1);box-shadow:0 0 8px rgba(37,99,235,0.6)}
    .info-icon .info-tooltip{visibility:hidden;background:#1f1f1f;color:#e0e0e0;border-radius:6px;padding:8px 12px;position:absolute;z-index:60;bottom:130%;left:50%;transform:translateX(-50%);width:max-content;max-width:220px;text-align:left;opacity:0;transition:opacity 0.3s,visibility 0.3s;box-shadow:0 4px 12px rgba(0,0,0,0.7);border:1px solid #3b82f6;font-size:11px;line-height:1.5;font-weight:normal;white-space:normal}
    .info-icon .info-tooltip::after{content:'';position:absolute;top:100%;left:50%;margin-left:-4px;border-width:4px;border-style:solid;border-color:#1f1f1f transparent transparent transparent}
    .info-icon:hover .info-tooltip{visibility:visible;opacity:1}

    /* Navigation Bar */
    .nav-bar{background:linear-gradient(135deg,#1e3a8a 0%,#1e40af 100%);padding:12px 24px;border-bottom:2px solid #3b82f6;display:flex;align-items:center;gap:24px;box-shadow:0 4px 12px rgba(0,0,0,0.5)}
    .nav-bar a{color:#e0e0e0;text-decoration:none;font-size:13px;font-weight:500;padding:8px 16px;border-radius:6px;transition:all 0.2s}
    .nav-bar a:hover{background:rgba(255,255,255,0.1)}
    .nav-bar a.active{background:#3b82f6;font-weight:600}
    .nav-brand{font-weight:700;font-size:14px;color:#60a5fa;margin-right:auto}
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel" data-presets="react,typescript">
    const { useMemo, useState, useEffect, useRef } = React;

    const marketsAll = [
      "Memphis","Dallasâ€“Fort Worth","Houston","Little Rock","Oklahoma City",
      "Tulsa","St. Louis","San Antonio","Birmingham","Huntsville","Tuscaloosa",
      "Chattanooga","Nashville","Knoxville","Jackson, TN"
    ];

    function roundToNearestTenK(n){ if(!isFinite(n)) return 0; return Math.round(n/10000)*10000; }
    function formatUSD(n){ return n.toLocaleString(undefined,{style:"currency",currency:"USD",maximumFractionDigits:0}); }

    // Info icon component with tooltip
    function InfoIcon({text}){
      return (
        <span className="info-icon">
          <span className="info-tooltip">{text}</span>
        </span>
      );
    }

    function App(){
      // **SCENARIO SELECTOR** (September actuals vs proforma)
      const [selectedScenario, setSelectedScenario] = useState('september-2025');

      // Scroll state for hero metrics
      const [isHeroSticky, setIsHeroSticky] = useState(false);
      const heroRef = useRef(null);
      const headerRef = useRef(null);

      useEffect(() => {
        const handleScroll = () => {
          if (heroRef.current && headerRef.current) {
            const headerHeight = headerRef.current.offsetHeight;
            const heroTop = heroRef.current.getBoundingClientRect().top;
            // When hero scrolls to touch the header, make it sticky
            setIsHeroSticky(heroTop <= headerHeight);
          }
        };

        window.addEventListener('scroll', handleScroll);
        handleScroll(); // Check initial position
        return () => window.removeEventListener('scroll', handleScroll);
      }, []);

      // Funnel inputs (Sept 2025 baseline: 59 deals/mo * 12 = 708/yr)
      const [intakes,setIntakes]=useState(48000);
      const [assessments,setAssessments]=useState(5000);
      const [offerRate,setOfferRate]=useState(0.50);
      const [acceptRate,setAcceptRate]=useState(0.60); // Tuned: 708 deals/yr
      const [closeRate,setCloseRate]=useState(0.472); // Tuned: 708 deals/yr

      // Mix / economics (Sept actuals: $675K/mo * 12 = $8.1M/yr)
      const [offMarketShare,setOffMarketShare]=useState(0.90);
      const [offMarketCapture,setOffMarketCapture]=useState(0.80);
      const [offMarketFee,setOffMarketFee]=useState(15442); // Tuned: $8.1M/yr GP
      const [mlsAvgPrice,setMlsAvgPrice]=useState(150000);
      const [mlsCommissionRate,setMlsCommissionRate]=useState(0.022);
      const [titleDirectCaptureRate,setTitleDirectCaptureRate]=useState(0.90); // Rebuilt off-market only
      const [titleProfitPerDeal,setTitleProfitPerDeal]=useState(400);

      // Infra
      const [activeMarkets,setActiveMarkets]=useState([...marketsAll.slice(0,8)]);
      const [infraPerMarketPerMonth,setInfraPerMarketPerMonth]=useState(2500);
      const [additionalMarkets,setAdditionalMarkets]=useState(0);

      // **MARKETING EXPENSE** (NEW)
      const [sellerMailPerMonth,setSellerMailPerMonth]=useState(545000); // Q3 avg: 1.635M Ã· 3
      const [sellerMailCostPerPiece,setSellerMailCostPerPiece]=useState(0.66);
      const [contractMailPerContract,setContractMailPerContract]=useState(200);
      const [contractMailCostPerPiece,setContractMailCostPerPiece]=useState(0.52);

      // **WHOLESALER AGENTS** (Internal sales agents - acquisition + disposition)
      // Sept actuals: 25 Acq, 24 Dispo = 49 total (user confirmed)
      const [numAcqAgents,setNumAcqAgents]=useState(25);
      const [numDispoAgents,setNumDispoAgents]=useState(24);
      const [pctAcqProducing,setPctAcqProducing]=useState(0.52); // 13/25 = 52% producing in Sept
      const [pctDispoProducing,setPctDispoProducing]=useState(0.58); // 14/24 = 58% producing in Sept
      const [wholesalerAgentBaseSalary,setWholesalerAgentBaseSalary]=useState(18000); // $1,500/mo
      const [flatFeeListedPct,setFlatFeeListedPct]=useState(0.41); // Sept: 24/59

      // **TIER RATE ADJUSTMENTS** (allow manual override of calculated tiers for top performers)
      const [acqTierAdjustment,setAcqTierAdjustment]=useState(0); // +/- % points
      const [dispoTierAdjustment,setDispoTierAdjustment]=useState(0); // +/- % points

      // **MANAGER / TEAM LEAD COMMISSIONS**
      // Sept actuals: $25,177 manager payout (3.73% of GP)
      const [managerCommissionPctOfGP,setManagerCommissionPctOfGP]=useState(3.73);
      const [numManagers,setNumManagers]=useState(4); // Sept: ~4 managers
      const [managerAvgBaseSalary,setManagerAvgBaseSalary]=useState(45000); // Estimated

      // **LICENSED BROKER %** (agents who can also do MLS deals - subset of wholesaler agents)
      const [pctAgentsLicensed,setPctAgentsLicensed]=useState(0.30); // 30% now, future 70%

      // Agent Outside Business (agents bring their own deals, not from Rebuilt funnel)
      const [agentOutsideSplitToAgent,setAgentOutsideSplitToAgent]=useState(0.80); // Agent gets 80%, firm gets 20%
      const [agentOutsideAvgPrice,setAgentOutsideAvgPrice]=useState(250000);
      const [agentOutsideDealsPerSeatPerYear,setAgentOutsideDealsPerSeatPerYear]=useState(1.0); // Low volume but real

      // **DEAD LEAD MONETIZATION** (unique IP) - handled by Agent Hybrid
      const [deadLeadConversionRate,setDeadLeadConversionRate]=useState(0.02);
      const [avgRetailDealValue,setAvgRetailDealValue]=useState(120000); // More realistic

      // **MARKETPLACE REVENUE** (Invoice + Honor System enforcement)
      const [thirdPartyWholesalers,setThirdPartyWholesalers]=useState(50);
      const [avgDealsPerWholesaler,setAvgDealsPerWholesaler]=useState(1.5); // Updated default
      const [marketplaceFeeRate,setMarketplaceFeeRate]=useState(0.005); // 0.5% base
      const [marketplaceMinFee,setMarketplaceMinFee]=useState(150); // $150 minimum
      const [avgWholesaleDealValue,setAvgWholesaleDealValue]=useState(30000); // Updated default

      // **PLATFORM SAAS** (Signing Tool + Rehab AI + ARV AI)
      const [saasActiveUsers,setSaasActiveUsers]=useState(100);
      const [saasBaseFee,setSaasBaseFee]=useState(10); // $10/mo base
      const [saasEnvelopes,setSaasEnvelopes]=useState(200); // monthly envelopes
      const [saasEnvelopeFee,setSaasEnvelopeFee]=useState(2); // $2/envelope
      const [titleSaasProfitPerDeal,setTitleSaasProfitPerDeal]=useState(400); // Title profit per deal
      const [titleSaasTransactionRate,setTitleSaasTransactionRate]=useState(0.20); // 20% transaction capture on platform deals

      // Rehab AI and ARV AI pricing
      const [rehabAIUsesPerMonth,setRehabAIUsesPerMonth]=useState(50); // Paid uses/mo (beyond 5 free)
      const [rehabAIFeePerUse,setRehabAIFeePerUse]=useState(2); // $2-$10
      const [arvAIUsesPerMonth,setArvAIUsesPerMonth]=useState(50); // Paid uses/mo (beyond 5 free)
      const [arvAIFeePerUse,setArvAIFeePerUse]=useState(2); // $2-$10

      // **LEAD SALES** (De-emphasized, warm leads to agents)
      const [leadSalesUnits,setLeadSalesUnits]=useState(0); // Default 0
      const [leadSalesPrice,setLeadSalesPrice]=useState(50); // $50/lead


      const funnel = useMemo(()=>{
        const offered  = Math.round(assessments*offerRate);
        const accepted = Math.round(offered*acceptRate);
        const closed   = Math.round(accepted*closeRate);
        return { offered, accepted, closed };
      },[assessments,offerRate,acceptRate,closeRate]);

      const economics = useMemo(()=>{
        const annualClosed   = Math.max(0,funnel.closed);
        const offMktAnnual   = Math.round(annualClosed*offMarketShare);
        const mlsAnnual      = Math.max(0, annualClosed - offMktAnnual);
        const capturedOffMkt = offMktAnnual*offMarketCapture;
        const offMarketFees  = capturedOffMkt*offMarketFee;
        const mlsCommission  = mlsAnnual*mlsAvgPrice*mlsCommissionRate;

        // Wholesale revenue (core business)
        const wholesaleRevenue = offMarketFees + mlsCommission;

        // Title Direct (Rebuilt off-market only, 90% capture)
        const titleDirectDeals = offMktAnnual * titleDirectCaptureRate;
        const titleDirectProfit = titleDirectDeals * titleProfitPerDeal;

        // **MARKETING EXPENSE** (NEW)
        const contractsAnnual = funnel.accepted; // Accepted offers = signed contracts
        const sellerMailAnnual = sellerMailPerMonth * 12;
        const contractMailAnnual = contractsAnnual * contractMailPerContract;
        const sellerMailCost = sellerMailAnnual * sellerMailCostPerPiece;
        const contractMailCost = contractMailAnnual * contractMailCostPerPiece;
        const totalMarketingCost = sellerMailCost + contractMailCost;

        // **WHOLESALER AGENT COMMISSIONS** (Internal sales agents on core wholesale business)
        // Commission tier functions from commission calculator
        const getAcqCommissionRate = (monthlyGP) => {
          if (monthlyGP < 25000) return 0.04;
          if (monthlyGP < 50000) return 0.06;
          if (monthlyGP < 100000) return 0.08;
          return 0.10;
        };
        const getDispoCommissionRate = (monthlyGP) => {
          if (monthlyGP < 25000) return 0.02;
          if (monthlyGP < 50000) return 0.03;
          if (monthlyGP < 75000) return 0.04;
          if (monthlyGP < 100000) return 0.05;
          if (monthlyGP < 125000) return 0.06;
          if (monthlyGP < 150000) return 0.07;
          if (monthlyGP < 175000) return 0.08;
          if (monthlyGP < 200000) return 0.09;
          return 0.10;
        };

        // Split wholesale revenue 50/50 between acq and dispo
        const acqGrossProfit = wholesaleRevenue * 0.5;
        const dispoGrossProfit = wholesaleRevenue * 0.5;

        // Calculate producing agent counts (used for tier calculation)
        const producingAcqAgents = Math.max(1, Math.round(numAcqAgents * pctAcqProducing));
        const producingDispoAgents = Math.max(1, Math.round(numDispoAgents * pctDispoProducing));

        // Monthly GP per PRODUCING agent (determines tier)
        // Only producing agents split the GP for tier calculation
        const acqMonthlyGPperAgent = (acqGrossProfit / 12) / producingAcqAgents;
        const dispoMonthlyGPperAgent = (dispoGrossProfit / 12) / producingDispoAgents;

        // Get commission rates based on tiers (with manual adjustments for top performers)
        const acqCommRate = Math.max(0, getAcqCommissionRate(acqMonthlyGPperAgent) + (acqTierAdjustment / 100));
        const dispoCommRate = Math.max(0, getDispoCommissionRate(dispoMonthlyGPperAgent) + (dispoTierAdjustment / 100));

        // Calculate agent variable commissions
        // Acq: straight percentage
        const acqAgentCommissions = acqGrossProfit * acqCommRate;

        // Dispo: split between off-market (full rate) and flat-fee listed (2/3 rate)
        const dispoOffMarketGP = dispoGrossProfit * (1 - flatFeeListedPct);
        const dispoFlatFeeGP = dispoGrossProfit * flatFeeListedPct;
        const dispoAgentCommissions = (dispoOffMarketGP * dispoCommRate) + (dispoFlatFeeGP * dispoCommRate * 0.6667);

        const wholesalerAgentCommissions = acqAgentCommissions + dispoAgentCommissions;

        // Manager / Team Lead Commissions (separate from agent commissions)
        const managerCommissions = wholesaleRevenue * (managerCommissionPctOfGP / 100);

        // Total variable compensation
        const totalVariableCompensation = wholesalerAgentCommissions + managerCommissions;

        // Wholesaler fixed costs (base + benefits)
        const totalWholesalerAgents = numAcqAgents + numDispoAgents;
        const producingAgents = producingAcqAgents + producingDispoAgents;
        const nonProducingAgents = totalWholesalerAgents - producingAgents;
        const wholesalerBaseCost = totalWholesalerAgents * wholesalerAgentBaseSalary;
        const wholesalerBenefitsCost = totalWholesalerAgents * ((wholesalerAgentBaseSalary * 0.15) + 5000);
        const wholesalerFixedCost = wholesalerBaseCost + wholesalerBenefitsCost;

        // Total wholesaler cost (fixed + variable)
        const totalWholesalerCost = wholesalerFixedCost + totalVariableCompensation;

        const totalMarkets   = activeMarkets.length + additionalMarkets;

        // **LICENSED BROKER AGENTS** (subset of wholesaler agents who can also do MLS deals)
        const infra          = infraPerMarketPerMonth*Math.max(0,totalMarkets)*12;

        // Only licensed agents bring outside MLS business (dead leads + outside deals)
        const licensedAgentSeats = totalWholesalerAgents * pctAgentsLicensed;

        // Agent Outside Business (licensed agents bring their own MLS deals)
        const agentOutsideTotalDeals = licensedAgentSeats * agentOutsideDealsPerSeatPerYear;
        const agentOutsideTotalCommission = agentOutsideTotalDeals * agentOutsideAvgPrice * mlsCommissionRate;
        const agentOutsideRevenueToCompany = agentOutsideTotalCommission; // Firm earns FULL commission
        const agentOutsideSplitCost = agentOutsideTotalCommission * agentOutsideSplitToAgent; // Then pays agent 80%

        // Dead Leads = Assessments - Accepted (relationship built but not under contract)
        const deadLeadsAnnual = Math.max(0, assessments - funnel.accepted);
        const deadLeadsMonthly = Math.round(deadLeadsAnnual / 12);
        const deadLeadConversions = deadLeadsAnnual * deadLeadConversionRate;

        // Dead lead revenue: Agents help convert to retail, company earns buy-side commission
        // Company earns full buyer commission (~2.2%), pays agent 50% of that as referral/split
        const deadLeadCommissionRate = mlsCommissionRate; // Use same commission rate as MLS retail deals
        const deadLeadRevenueToCompany = deadLeadConversions * avgRetailDealValue * deadLeadCommissionRate;
        const deadLeadSplitCost = deadLeadRevenueToCompany * 0.5; // Pay agent 50% of the commission

        // Total licensed agent revenue and costs (dead leads + outside business)
        const licensedAgentRevenueToCompany = deadLeadRevenueToCompany + agentOutsideRevenueToCompany;
        const licensedAgentSplitCost = deadLeadSplitCost + agentOutsideSplitCost;

        // TOTAL AGENT COST = Wholesaler (fixed + variable) + Licensed agent splits
        const totalAgentCost = totalWholesalerCost + licensedAgentSplitCost;

        // Marketplace Revenue ($150 min OR x%, whichever greater)
        const marketplaceDealsAnnual = thirdPartyWholesalers * avgDealsPerWholesaler * 12;
        const marketplaceFeePerDeal = Math.max(
          avgWholesaleDealValue * marketplaceFeeRate,
          marketplaceMinFee
        );
        const marketplaceRevenue = marketplaceDealsAnnual * marketplaceFeePerDeal;

        // Platform SaaS (Signing + Rehab AI + ARV AI)
        const saasMRR = (saasActiveUsers * saasBaseFee) + (saasEnvelopes * saasEnvelopeFee);
        const saasARR = saasMRR * 12;

        // Rehab AI and ARV AI revenue (paid uses beyond 5 free per user)
        const rehabAIRevenue = rehabAIUsesPerMonth * rehabAIFeePerUse * 12;
        const arvAIRevenue = arvAIUsesPerMonth * arvAIFeePerUse * 12;

        // Title SaaS (20% capture on marketplace + agent dead lead deals)
        const platformDealsAnnual = marketplaceDealsAnnual + deadLeadConversions;
        const titleSaasProfit = platformDealsAnnual * titleSaasTransactionRate * titleSaasProfitPerDeal;

        // Lead Sales (de-emphasized, default 0)
        const leadSalesRevenue = leadSalesUnits * leadSalesPrice * 12;

        const gross = offMarketFees + mlsCommission + titleDirectProfit + licensedAgentRevenueToCompany + marketplaceRevenue + saasARR + rehabAIRevenue + arvAIRevenue + titleSaasProfit + leadSalesRevenue;
        const net   = gross - infra - totalAgentCost;

        return {
          annualClosed, offMktAnnual, mlsAnnual,
          offMarketFees, mlsCommission, titleDirectProfit,
          infra, totalAgentCost, gross, net,
          wholesaler: {
            numAcq: numAcqAgents,
            numDispo: numDispoAgents,
            totalAgents: totalWholesalerAgents,
            producingAcqAgents,
            producingDispoAgents,
            producingAgents,
            nonProducingAgents,
            pctAcqProducing,
            pctDispoProducing,
            acqGP: acqGrossProfit,
            dispoGP: dispoGrossProfit,
            acqCommRate,
            dispoCommRate,
            acqAgentCommissions,
            dispoAgentCommissions,
            agentCommissions: wholesalerAgentCommissions,
            managerCommissions,
            totalVariableComp: totalVariableCompensation,
            baseCost: wholesalerBaseCost,
            benefitsCost: wholesalerBenefitsCost,
            fixedCost: wholesalerFixedCost,
            totalCost: totalWholesalerCost
          },
          deadLead: {
            monthly: deadLeadsMonthly,
            annualLeads: deadLeadsAnnual,
            conversions: deadLeadConversions,
            conversionRate: deadLeadConversionRate
          },
          marketplace: {
            wholesalers: thirdPartyWholesalers,
            dealsAnnual: marketplaceDealsAnnual,
            feePerDeal: marketplaceFeePerDeal,
            revenue: marketplaceRevenue
          },
          platformSaaS: {
            activeUsers: saasActiveUsers,
            mrr: saasMRR,
            arr: saasARR,
            rehabAIRevenue,
            arvAIRevenue,
            titleSaasProfit,
            leadSalesRevenue,
            totalSaasRevenue: saasARR + rehabAIRevenue + arvAIRevenue + titleSaasProfit + leadSalesRevenue
          },
          licensedAgent: {
            seats: licensedAgentSeats,
            pctLicensed: pctAgentsLicensed,
            totalMarkets,
            additionalMarkets,
            revenueToCompany: licensedAgentRevenueToCompany,
            splitCost: licensedAgentSplitCost,
            outsideBusiness: {
              dealsPerYear: agentOutsideTotalDeals,
              revenueToCompany: agentOutsideRevenueToCompany,
              splitCost: agentOutsideSplitCost
            }
          },
          rounded:{
            offMarketFees: roundToNearestTenK(offMarketFees),
            mlsCommission: roundToNearestTenK(mlsCommission),
            titleDirectProfit: roundToNearestTenK(titleDirectProfit),
            marketplaceRevenue: roundToNearestTenK(marketplaceRevenue),
            platformSaasTotal: roundToNearestTenK(saasARR + rehabAIRevenue + arvAIRevenue + titleSaasProfit + leadSalesRevenue),
            gross: roundToNearestTenK(gross),
            net: roundToNearestTenK(net),
            licensedAgentRevenue: roundToNearestTenK(licensedAgentRevenueToCompany),
            totalAgentCost: roundToNearestTenK(totalAgentCost)
          }
        };
      },[
        funnel.closed, funnel.accepted, assessments,
        offMarketShare, offMarketCapture, offMarketFee,
        mlsAvgPrice, mlsCommissionRate, titleDirectCaptureRate, titleProfitPerDeal,
        infraPerMarketPerMonth, activeMarkets.length, additionalMarkets,
        numAcqAgents, numDispoAgents, pctAcqProducing, pctDispoProducing, wholesalerAgentBaseSalary, flatFeeListedPct,
        acqTierAdjustment, dispoTierAdjustment,
        managerCommissionPctOfGP, numManagers, managerAvgBaseSalary, pctAgentsLicensed,
        agentOutsideSplitToAgent, agentOutsideAvgPrice, agentOutsideDealsPerSeatPerYear,
        deadLeadConversionRate, avgRetailDealValue,
        thirdPartyWholesalers, avgDealsPerWholesaler, marketplaceFeeRate, marketplaceMinFee, avgWholesaleDealValue,
        saasActiveUsers, saasBaseFee, saasEnvelopes, saasEnvelopeFee, titleSaasProfitPerDeal, titleSaasTransactionRate,
        rehabAIUsesPerMonth, rehabAIFeePerUse, arvAIUsesPerMonth, arvAIFeePerUse,
        leadSalesUnits, leadSalesPrice
      ]);

      const assessmentsPct = useMemo(()=> !intakes?0:Math.round((assessments/intakes)*100), [assessments,intakes]);

      const netSegments = useMemo(()=>{
        const segments = [
          { key:"offMarket", label:"Off-Market", value:economics.offMarketFees, tone:"positive" },
          { key:"mls", label:"MLS", value:economics.mlsCommission, tone:"positive" },
          { key:"titleDirect", label:"Title Direct", value:economics.titleDirectProfit, tone:"positive" },
          { key:"agentRevenue", label:"Agent Revenue", value:economics.licensedAgent.revenueToCompany, tone:"positive" },
          { key:"marketplace", label:"Marketplace", value:economics.marketplace.revenue, tone:"positive", highlight:true },
          { key:"platformSaaS", label:"Platform SaaS", value:economics.platformSaaS.totalSaasRevenue, tone:"positive", highlight:true },
          { key:"infra", label:"Infrastructure", value:-economics.infra, tone:"negative" },
          { key:"agentCost", label:"Agent Cost", value:-economics.totalAgentCost, tone:"negative" }
        ];
        const maxMagnitude = Math.max(...segments.map(s=>Math.abs(s.value)),1);
        return segments.map(segment=>{
          const magnitude = Math.abs(segment.value);
          const scale = magnitude/maxMagnitude;
          const widthPct = Math.max(8, Math.round(scale*100));
          return {
            ...segment,
            magnitude,
            scale,
            widthPct
          };
        });
      },[
        economics.offMarketFees,
        economics.mlsCommission,
        economics.titleDirectProfit,
        economics.licensedAgent.revenueToCompany,
        economics.marketplace.revenue,
        economics.platformSaaS.totalSaasRevenue,
        economics.infra,
        economics.totalAgentCost
      ]);

      return (
        <div className="min-h-screen bg-neutral-900 text-neutral-100">
          <header ref={headerRef} className="sticky top-0 z-20 backdrop-blur bg-neutral-800/95 border-b border-neutral-700 shadow-lg">
            <div className="mx-auto max-w-7xl px-4 py-4 flex items-center justify-between">
              <div className="flex items-center gap-3">
                <h1 className="text-xl md:text-2xl font-bold tracking-tight bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent">Rebuilt Ã— Picket</h1>
                <span className="hidden sm:inline text-sm text-neutral-400">Financial Model</span>
              </div>
              <div className="flex items-center gap-4">
                <div className="flex items-center gap-2">
                  <label className="text-xs text-neutral-400 font-medium">Scenario:</label>
                  <select
                    value={selectedScenario}
                    onChange={e=>setSelectedScenario(e.target.value)}
                    className="px-3 py-1.5 text-sm bg-neutral-700 text-neutral-200 border border-neutral-600 rounded-lg hover:bg-neutral-600 focus:outline-none focus:ring-2 focus:ring-blue-500 cursor-pointer"
                  >
                    <option value="september-2025">September 2025 (Actual)</option>
                    <option value="q4-2025-proforma">Q4 2025 Proforma</option>
                    <option value="2026-conservative">2026 Conservative</option>
                    <option value="2026-aggressive">2026 Aggressive</option>
                    <option value="custom">Custom</option>
                  </select>
                </div>
                <div className="flex gap-3">
                  <a className="text-sm text-cyan-400 hover:text-cyan-300 underline" href="../reconciled/full_dashboard/index.html">Home</a>
                  <a className="text-sm text-blue-400 hover:text-blue-300 underline" href="../comps/index.html">Market Intel</a>
                  <a className="text-sm text-emerald-400 hover:text-emerald-300" href="../reconciled/full_dashboard/index.html" title="Commission Intelligence Platform - Analytics & insights">ðŸ“Š</a>
                </div>
              </div>
            </div>
          </header>

          {/* Spacer to give hero initial position below header */}
          <div className="h-6"></div>

          {/* Hero Metrics Dashboard */}
          <div
            ref={heroRef}
            className={isHeroSticky ? "fixed left-0 right-0 z-30 bg-neutral-900 border-b border-neutral-800" : "relative bg-neutral-900 border-b border-neutral-800"}
            style={isHeroSticky ? {top: `${headerRef.current?.offsetHeight || 73}px`} : {}}
          >
            <div className="mx-auto max-w-7xl px-4 py-6">
              <div className="grid grid-cols-2 md:grid-cols-4 gap-4 fade-in">
                <div className="p-4 dark-card rounded-xl border shadow-lg pulsing" title="Gross Revenue âˆ’ Infrastructure âˆ’ Agent Cost">
                  <div className="text-xs uppercase tracking-wider text-neutral-400 mb-1">Adjusted Annual Gross</div>
                  <div className="text-2xl font-bold text-blue-400">{formatUSD(economics.rounded.net)}</div>
                </div>
                <div className="p-4 dark-card rounded-xl border shadow-lg" title="Off-Market + MLS + Title Direct + Agent Revenue + Marketplace + Platform SaaS">
                  <div className="text-xs uppercase tracking-wider text-neutral-400 mb-1">Gross Revenue</div>
                  <div className="text-2xl font-bold text-neutral-100">{formatUSD(economics.rounded.gross)}</div>
                </div>
                <div className="p-4 dark-card rounded-xl border shadow-lg" title="(Assessments/year âˆ’ Accepted/year) Ã· 12">
                  <div className="text-xs uppercase tracking-wider text-neutral-400 mb-1">Dead Leads</div>
                  <div className="text-2xl font-bold text-cyan-400">{economics.deadLead.monthly.toLocaleString()}/mo</div>
                  <div className="text-[10px] mt-1 text-neutral-500">{Math.round(economics.deadLead.conversions)} conversions/yr via agents</div>
                </div>
                <div className="p-4 dark-card rounded-xl border shadow-lg" title="Marketplace Revenue + Platform SaaS (Signing + Rehab AI + ARV AI + Title SaaS + Lead Sales)">
                  <div className="text-xs uppercase tracking-wider text-neutral-400 mb-1">Marketplace + SaaS</div>
                  <div className="text-2xl font-bold text-blue-400">{formatUSD(economics.rounded.marketplaceRevenue + economics.rounded.platformSaasTotal)}</div>
                  <div className="text-[10px] mt-1 text-neutral-500">{economics.marketplace.dealsAnnual.toLocaleString()} deals/yr + {economics.platformSaaS.activeUsers} users</div>
                </div>
              </div>
            </div>
          </div>

          {/* Spacer when hero becomes fixed to prevent content jump */}
          {isHeroSticky && <div className="h-[180px]"></div>}

          {/* Competitive Advantage - Scrolls normally */}
          <div className="mx-auto max-w-7xl px-4 mt-6">
            <div className="p-4 dark-card border rounded-xl">
              <div className="flex items-start gap-3">
                <div className="flex-shrink-0 w-6 h-6 rounded-full bg-blue-600 text-white flex items-center justify-center text-xs font-bold">i</div>
                <div className="text-sm text-neutral-300">
                  <strong className="text-blue-400">Competitive Advantage:</strong> Dead leads handled by Agent Hybrid model (50/50 split). Marketplace + Platform SaaS revenue streams are <strong className="text-blue-400">unique to Rebuilt</strong>.<br/>
                  InvestorLift, New Western, and EasyStreetOffers do not offer open marketplace aggregation or integrated platform tools.
                </div>
              </div>
            </div>
          </div>

          <main className="mx-auto max-w-7xl px-4 pb-24">
            {/* Markets toggle */}
            <section className="mt-8 p-6 dark-card rounded-2xl shadow-sm border border-neutral-700">
              <div className="flex items-center justify-between gap-4 flex-wrap">
                <h2 className="text-lg font-semibold">Markets</h2>
                <div className="text-sm text-neutral-400">Toggle to include in infra & agent modeling</div>
              </div>
              <div className="mt-4 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2">
                {marketsAll.map(m=>{
                  const active = activeMarkets.includes(m);
                  return (
                    <button key={m}
                      onClick={()=>setActiveMarkets(p=>p.includes(m)?p.filter(x=>x!==m):[...p,m])}
                      className={`px-3 py-2 text-sm rounded-xl border transition text-center ${active ? "bg-emerald-600 text-white border-emerald-600" : "dark-card border-neutral-300 hover:border-neutral-400"}`}
                      aria-pressed={active}>{m}</button>
                  );
                })}
              </div>
              <div className="mt-6 pt-4 border-t border-neutral-700">
                <div className="flex items-center justify-between text-sm">
                  <span>Additional markets</span>
                  <span className="font-medium text-neutral-300">{additionalMarkets.toLocaleString()} ({economics.licensedAgent.totalMarkets.toLocaleString()} total)</span>
                </div>
                <input
                  className="mt-2 w-full"
                  type="range"
                  min={0}
                  max={100}
                  step={1}
                  value={additionalMarkets}
                  onChange={e=>{
                    const next = parseInt(e.target.value,10);
                    setAdditionalMarkets(Number.isNaN(next)?0:next);
                  }}
                />
                <div className="mt-2 text-xs text-neutral-500">Adds unnamed markets on top of those toggled above.</div>
              </div>
            </section>

            {/* Funnel */}
            <section className="mt-8 grid gap-6 md:grid-cols-2">
              <div className="space-y-4">
                <div className="p-6 dark-card rounded-2xl shadow-sm border border-neutral-700">
                  <div className="flex items-start justify-between mb-4">
                    <h2 className="text-lg font-semibold">Acquisitions Funnel (12-month)</h2>
                    <div className="text-xs text-neutral-500">Sept baseline: 59 deals/mo</div>
                  </div>

                  {/* Funnel Results Summary */}
                  <div className="mb-4 p-3 bg-blue-900/20 border border-blue-700 rounded-lg">
                    <div className="grid grid-cols-2 gap-3 text-sm">
                      <div>
                        <div className="text-xs text-blue-400 uppercase tracking-wider mb-1">Annual Deals</div>
                        <div className="text-2xl font-bold text-blue-300">{economics.annualClosed.toLocaleString()}</div>
                        <div className="text-xs text-blue-600">{Math.round(economics.annualClosed / 12)} deals/month avg</div>
                      </div>
                      <div>
                        <div className="text-xs text-blue-400 uppercase tracking-wider mb-1">Wholesale GP</div>
                        <div className="text-2xl font-bold text-blue-300">{formatUSD(economics.offMarketFees + economics.mlsCommission)}</div>
                        <div className="text-xs text-blue-600">{formatUSD((economics.offMarketFees + economics.mlsCommission) / 12)}/month avg</div>
                      </div>
                    </div>
                  </div>

                  <div className="grid gap-4">
                    <label className="text-sm">Intakes (annual): <span className="font-medium">{intakes.toLocaleString()}/year</span></label>
                    <input type="range" min={0} max={150000} step={500} value={intakes} onChange={e=>setIntakes(parseInt(e.target.value))}/>
                    <label className="text-sm">Assessments (annual): <span className="font-medium">{assessments.toLocaleString()}/year ({assessmentsPct}%)</span></label>
                    <input type="range" min={0} max={20000} step={50} value={assessments} onChange={e=>setAssessments(parseInt(e.target.value))}/>
                    <div className="grid grid-cols-3 gap-3 text-sm">
                      <div><div>Offer: <span className="font-medium">{Math.round(offerRate*100)}%</span></div><input type="range" min={0} max={0.9} step={0.01} value={offerRate} onChange={e=>setOfferRate(parseFloat(e.target.value))}/></div>
                      <div><div>Accept: <span className="font-medium">{Math.round(acceptRate*100)}%</span></div><input type="range" min={0} max={0.9} step={0.01} value={acceptRate} onChange={e=>setAcceptRate(parseFloat(e.target.value))}/></div>
                      <div><div>Close: <span className="font-medium">{Math.round(closeRate*100)}%</span></div><input type="range" min={0} max={0.9} step={0.01} value={closeRate} onChange={e=>setCloseRate(parseFloat(e.target.value))}/></div>
                    </div>
                  </div>
                </div>
                <div className="p-6 dark-card rounded-2xl shadow-sm border border-neutral-700">
                  <h3 className="text-sm font-semibold mb-3">Infrastructure Modeling</h3>
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <div className="flex items-center gap-3">
                        <div className="text-sm flex-shrink-0">Total markets: <span className="font-medium">{economics.licensedAgent.totalMarkets.toLocaleString()}</span></div>
                        <input className="flex-1" type="range" min={0} max={15} step={1} value={additionalMarkets} onChange={e=>setAdditionalMarkets(parseInt(e.target.value))} />
                      </div>
                      <div className="mt-1 text-xs text-neutral-500">Selected: {activeMarkets.length.toLocaleString()} â€¢ Additional: {additionalMarkets.toLocaleString()}</div>
                    </div>
                    <div>
                      <div className="flex items-center gap-3">
                        <div className="text-sm flex-shrink-0">Per-market / month: <span className="font-medium">{formatUSD(infraPerMarketPerMonth)}</span></div>
                        <input className="flex-1" type="range" min={1000} max={5000} step={100} value={infraPerMarketPerMonth} onChange={e=>setInfraPerMarketPerMonth(parseInt(e.target.value))} />
                      </div>
                      <div className="mt-1 text-xs text-neutral-500">Annual infrastructure spend: {formatUSD(economics.infra)}</div>
                    </div>
                  </div>
                </div>
              </div>

              {/* Mix & economics */}
              <div className="p-6 dark-card rounded-2xl shadow-sm border border-neutral-700">
                <h2 className="text-lg font-semibold">Deal Mix & Economics</h2>
                <div className="mt-2 text-xs text-neutral-500">Volumes derive from the funnel's <span className="font-medium text-neutral-300">Closed</span> count.</div>
                <div className="mt-4 grid gap-4">
                  <div>
                    <div className="text-sm">
                      Off-Market Share: <span className="font-medium">{Math.round(offMarketShare*100)}%</span>
                      <InfoIcon text="% of closed deals that are off-market assignments vs MLS-listed properties" />
                    </div>
                    <input type="range" min={0} max={1} step={0.01} value={offMarketShare} onChange={e=>setOffMarketShare(parseFloat(e.target.value))}/>
                    <div className="mt-1 text-xs text-neutral-500">Off-Mkt: {economics.offMktAnnual.toLocaleString()} â€¢ MLS: {economics.mlsAnnual.toLocaleString()}</div>
                  </div>
                  <div className="grid grid-cols-3 gap-3 text-sm">
                    <div>
                      <div>
                        Off-Mkt Capture: <span className="font-medium">{Math.round(offMarketCapture*100)}%</span>
                        <InfoIcon text="% of off-market deals where Rebuilt captures the assignment fee (vs seller backing out or deal falling through)" />
                      </div>
                      <input type="range" min={0.4} max={1} step={0.01} value={offMarketCapture} onChange={e=>setOffMarketCapture(parseFloat(e.target.value))}/>
                    </div>
                    <div>
                      <div>
                        Off-Mkt Revenue: <span className="font-medium">{formatUSD(offMarketFee)}</span>
                        <InfoIcon text="Gross profit per off-market deal (assignment fee after transaction costs)" />
                      </div>
                      <input type="range" min={0} max={20000} step={500} value={offMarketFee} onChange={e=>setOffMarketFee(parseInt(e.target.value))}/>
                    </div>
                    <div>
                      <div>
                        Title Direct Capture: <span className="font-medium">{Math.round(titleDirectCaptureRate*100)}%</span>
                        <InfoIcon text="% of Rebuilt off-market deals where we also close title through National Title Service" />
                      </div>
                      <input type="range" min={0.5} max={1} step={0.01} value={titleDirectCaptureRate} onChange={e=>setTitleDirectCaptureRate(parseFloat(e.target.value))}/>
                    </div>
                  </div>
                  <div className="grid grid-cols-3 gap-3 text-sm">
                    <div><div>MLS Avg Price: <span className="font-medium">{formatUSD(mlsAvgPrice)}</span></div><input type="range" min={100000} max={300000} step={5000} value={mlsAvgPrice} onChange={e=>setMlsAvgPrice(parseInt(e.target.value))}/></div>
                    <div><div>MLS Commission: <span className="font-medium">{(mlsCommissionRate*100).toFixed(1)}%</span></div><input type="range" min={0.01} max={0.04} step={0.001} value={mlsCommissionRate} onChange={e=>setMlsCommissionRate(parseFloat(e.target.value))}/></div>
                    <div><div>Title Profit/Deal: <span className="font-medium">{formatUSD(titleProfitPerDeal)}</span></div><input type="range" min={200} max={800} step={25} value={titleProfitPerDeal} onChange={e=>setTitleProfitPerDeal(parseInt(e.target.value))}/></div>
                  </div>

                  {/* MLS Metrics Summary */}
                  <div className="mt-6 p-4 bg-neutral-800 rounded-lg border border-neutral-700">
                    <h4 className="text-xs font-semibold text-neutral-400 uppercase tracking-wider mb-3">MLS Deal Metrics</h4>
                    <div className="grid grid-cols-3 gap-4 text-sm">
                      <div>
                        <div className="text-xs text-neutral-500 mb-1">Annual MLS Units</div>
                        <div className="text-lg font-semibold text-blue-300">{economics.mlsAnnual.toLocaleString()}</div>
                      </div>
                      <div>
                        <div className="text-xs text-neutral-500 mb-1">Total MLS Revenue</div>
                        <div className="text-lg font-semibold text-blue-300">{formatUSD(economics.mlsCommission)}</div>
                      </div>
                      <div>
                        <div className="text-xs text-neutral-500 mb-1">Avg Revenue/Deal</div>
                        <div className="text-lg font-semibold text-blue-300">{formatUSD(economics.mlsCommission / Math.max(economics.mlsAnnual, 1))}</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </section>

            {/* WHOLESALE DEAL ECONOMICS (Detailed Breakdown) */}
            <section className="mt-8 p-6 dark-card border-2 border-cyan-600 rounded-2xl shadow-md fade-in">
              <div className="flex items-start justify-between gap-4 flex-wrap mb-4">
                <div>
                  <h2 className="text-lg font-bold text-cyan-300">Wholesale Deal Economics</h2>
                  <p className="text-sm text-cyan-700 mt-1">Detailed breakdown: Revenue â†’ Agent Costs â†’ Manager Costs â†’ Net</p>
                </div>
                <div className="px-3 py-1 bg-cyan-600 text-white text-xs font-bold uppercase tracking-wider rounded-full">Sept Actuals</div>
              </div>

              {/* Summary Cards */}
              <div className="grid md:grid-cols-4 gap-4 mb-6">
                <div className="p-4 dark-card rounded-xl border border-cyan-700">
                  <div className="text-xs text-cyan-700 uppercase tracking-wider mb-1">Wholesale Revenue</div>
                  <div className="text-2xl font-bold text-cyan-300">{formatUSD(economics.offMarketFees + economics.mlsCommission)}</div>
                  <div className="text-xs text-cyan-600 mt-1">Off-Mkt + MLS</div>
                </div>
                <div className="p-4 dark-card rounded-xl border border-blue-700">
                  <div className="text-xs text-blue-700 uppercase tracking-wider mb-1">Agent Commissions</div>
                  <div className="text-2xl font-bold text-blue-300">{formatUSD(economics.wholesaler.agentCommissions)}</div>
                  <div className="text-xs text-blue-600 mt-1">{((economics.wholesaler.agentCommissions / (economics.offMarketFees + economics.mlsCommission)) * 100).toFixed(1)}% of GP</div>
                </div>
                <div className="p-4 dark-card rounded-xl border border-amber-700">
                  <div className="text-xs text-amber-700 uppercase tracking-wider mb-1">Manager Commissions</div>
                  <div className="text-2xl font-bold text-amber-300">{formatUSD(economics.wholesaler.managerCommissions)}</div>
                  <div className="text-xs text-amber-600 mt-1">{managerCommissionPctOfGP.toFixed(2)}% of GP</div>
                </div>
                <div className="p-4 dark-card rounded-xl border border-green-700">
                  <div className="text-xs text-green-700 uppercase tracking-wider mb-1">Total Variable Comp</div>
                  <div className="text-2xl font-bold text-green-300">{formatUSD(economics.wholesaler.totalVariableComp)}</div>
                  <div className="text-xs text-green-600 mt-1">{((economics.wholesaler.totalVariableComp / (economics.offMarketFees + economics.mlsCommission)) * 100).toFixed(1)}% of GP</div>
                </div>
              </div>

              {/* Agent Headcount & Modeling - 2x2 Grid */}
              <div className="grid md:grid-cols-2 gap-6">
                {/* LEFT COLUMN: Agent Headcount */}
                <div className="space-y-4">
                  <h3 className="text-sm font-bold text-cyan-300">Wholesaler Agent Headcount</h3>

                  {/* Acq Agents - Side by Side */}
                  <div className="grid grid-cols-2 gap-3">
                    <div>
                      <div className="text-xs text-cyan-300 mb-1">Acq agents: <span className="font-bold">{numAcqAgents}</span></div>
                      <input className="w-full" type="range" min={5} max={75} step={1} value={numAcqAgents} onChange={e=>setNumAcqAgents(parseInt(e.target.value))} />
                      <div className="mt-1 text-[10px] text-cyan-600">GP/agent/mo: {formatUSD((economics.wholesaler.acqGP / 12) / numAcqAgents)}</div>
                    </div>
                    <div>
                      <div className="text-xs text-cyan-300 mb-1">Acq % producing: <span className="font-bold">{Math.round(pctAcqProducing*100)}%</span></div>
                      <input className="w-full" type="range" min={0.3} max={1} step={0.05} value={pctAcqProducing} onChange={e=>setPctAcqProducing(parseFloat(e.target.value))} />
                      <div className="mt-1 text-[10px] text-cyan-600">{economics.wholesaler.producingAcqAgents} producing, {numAcqAgents - economics.wholesaler.producingAcqAgents} new/non-producing</div>
                    </div>
                  </div>

                  {/* Dispo Agents - Side by Side */}
                  <div className="grid grid-cols-2 gap-3">
                    <div>
                      <div className="text-xs text-cyan-300 mb-1">Dispo agents: <span className="font-bold">{numDispoAgents}</span></div>
                      <input className="w-full" type="range" min={5} max={75} step={1} value={numDispoAgents} onChange={e=>setNumDispoAgents(parseInt(e.target.value))} />
                      <div className="mt-1 text-[10px] text-cyan-600">GP/agent/mo: {formatUSD((economics.wholesaler.dispoGP / 12) / numDispoAgents)}</div>
                    </div>
                    <div>
                      <div className="text-xs text-cyan-300 mb-1">Dispo % producing: <span className="font-bold">{Math.round(pctDispoProducing*100)}%</span></div>
                      <input className="w-full" type="range" min={0.3} max={1} step={0.05} value={pctDispoProducing} onChange={e=>setPctDispoProducing(parseFloat(e.target.value))} />
                      <div className="mt-1 text-[10px] text-cyan-600">{economics.wholesaler.producingDispoAgents} producing, {numDispoAgents - economics.wholesaler.producingDispoAgents} new/non-producing</div>
                    </div>
                  </div>

                  {/* Tier Rate Adjustments - Side by Side */}
                  <div className="grid grid-cols-2 gap-3">
                    <div>
                      <div className="text-xs text-cyan-300 mb-1">Acq tier rate: <span className="font-bold">{(economics.wholesaler.acqCommRate*100).toFixed(2)}%</span></div>
                      <input className="w-full" type="range" min={-2} max={2} step={0.25} value={acqTierAdjustment} onChange={e=>setAcqTierAdjustment(parseFloat(e.target.value))} />
                      <div className="mt-1 text-[10px] text-cyan-600">Adjust: {acqTierAdjustment >= 0 ? '+' : ''}{acqTierAdjustment.toFixed(2)}%</div>
                    </div>
                    <div>
                      <div className="text-xs text-cyan-300 mb-1">Dispo tier rate: <span className="font-bold">{(economics.wholesaler.dispoCommRate*100).toFixed(2)}%</span></div>
                      <input className="w-full" type="range" min={-2} max={2} step={0.25} value={dispoTierAdjustment} onChange={e=>setDispoTierAdjustment(parseFloat(e.target.value))} />
                      <div className="mt-1 text-[10px] text-cyan-600">Adjust: {dispoTierAdjustment >= 0 ? '+' : ''}{dispoTierAdjustment.toFixed(2)}%</div>
                    </div>
                  </div>

                  {/* Base Salary & Flat-Fee - Side by Side */}
                  <div className="grid grid-cols-2 gap-3">
                    <div>
                      <div className="text-xs text-cyan-300 mb-1">Base salary (annual): <span className="font-bold">{formatUSD(wholesalerAgentBaseSalary)}</span></div>
                      <input className="w-full" type="range" min={0} max={30000} step={1000} value={wholesalerAgentBaseSalary} onChange={e=>setWholesalerAgentBaseSalary(parseInt(e.target.value))} />
                      <div className="mt-1 text-[10px] text-cyan-600">{formatUSD(wholesalerAgentBaseSalary / 12)}/mo per agent</div>
                    </div>
                    <div>
                      <div className="text-xs text-cyan-300 mb-1">Flat-fee listed: <span className="font-bold">{Math.round(flatFeeListedPct*100)}%</span></div>
                      <input className="w-full" type="range" min={0} max={1} step={0.01} value={flatFeeListedPct} onChange={e=>setFlatFeeListedPct(parseFloat(e.target.value))} />
                      <div className="mt-1 text-[10px] text-cyan-600">Pays 2/3 commission rate</div>
                    </div>
                  </div>
                </div>

                {/* RIGHT COLUMN: Managers & Costs */}
                <div className="space-y-4">
                  <h3 className="text-sm font-bold text-amber-300">Manager & Cost Breakdown</h3>

                  {/* Managers - Side by Side */}
                  <div className="grid grid-cols-2 gap-3">
                    <div>
                      <div className="text-xs text-amber-300 mb-1">Number of managers: <span className="font-bold">{numManagers}</span></div>
                      <input className="w-full" type="range" min={1} max={15} step={1} value={numManagers} onChange={e=>setNumManagers(parseInt(e.target.value))} />
                      <div className="mt-1 text-[10px] text-amber-600">Acq + Dispo managers</div>
                    </div>
                    <div>
                      <div className="text-xs text-amber-300 mb-1">Mgr comm % of GP: <span className="font-bold">{managerCommissionPctOfGP.toFixed(2)}%</span></div>
                      <input className="w-full" type="range" min={0} max={10} step={0.25} value={managerCommissionPctOfGP} onChange={e=>setManagerCommissionPctOfGP(parseFloat(e.target.value))} />
                      <div className="mt-1 text-[10px] text-amber-600">Sept: 3.73% ($25K)</div>
                    </div>
                  </div>

                  {/* Manager Base Salary & Licensed % - Side by Side */}
                  <div className="grid grid-cols-2 gap-3">
                    <div>
                      <div className="text-xs text-amber-300 mb-1">Mgr base salary: <span className="font-bold">{formatUSD(managerAvgBaseSalary)}</span></div>
                      <input className="w-full" type="range" min={30000} max={80000} step={5000} value={managerAvgBaseSalary} onChange={e=>setManagerAvgBaseSalary(parseInt(e.target.value))} />
                      <div className="mt-1 text-[10px] text-amber-600">{formatUSD(managerAvgBaseSalary / 12)}/mo per manager</div>
                    </div>
                    <div>
                      <div className="text-xs text-neutral-300 mb-1">% Licensed (MLS): <span className="font-bold">{Math.round(pctAgentsLicensed*100)}%</span></div>
                      <input className="w-full" type="range" min={0} max={1} step={0.05} value={pctAgentsLicensed} onChange={e=>setPctAgentsLicensed(parseFloat(e.target.value))} />
                      <div className="mt-1 text-[10px] text-neutral-500">{economics.licensedAgent.seats.toFixed(1)} licensed agents</div>
                    </div>
                  </div>

                  {/* Cost Summary */}
                  <div className="mt-4 p-3 dark-card rounded-xl border border-neutral-600">
                    <div className="text-xs font-bold text-neutral-400 mb-2">Cost Summary (annual)</div>
                    <div className="space-y-1 text-xs">
                      <div className="flex justify-between"><span className="text-neutral-500">Agent base salaries:</span><span className="font-bold">{formatUSD(economics.wholesaler.baseCost)}</span></div>
                      <div className="flex justify-between"><span className="text-neutral-500">Agent benefits:</span><span className="font-bold">{formatUSD(economics.wholesaler.benefitsCost)}</span></div>
                      <div className="flex justify-between border-t border-neutral-600 pt-1"><span className="text-neutral-500">Agent Fixed Cost:</span><span className="font-bold">{formatUSD(economics.wholesaler.fixedCost)}</span></div>
                      <div className="flex justify-between"><span className="text-neutral-500">Agent Variable:</span><span className="font-bold text-blue-300">{formatUSD(economics.wholesaler.agentCommissions)}</span></div>
                      <div className="flex justify-between"><span className="text-neutral-500">Manager Variable:</span><span className="font-bold text-amber-300">{formatUSD(economics.wholesaler.managerCommissions)}</span></div>
                      <div className="flex justify-between border-t border-neutral-600 pt-1"><span className="font-bold">Total Wholesaler Cost:</span><span className="font-bold text-green-300">{formatUSD(economics.wholesaler.totalCost)}</span></div>
                    </div>
                  </div>
                </div>
              </div>
            </section>

            {/* DEAD LEAD TRACKING (Handled by Agent Hybrid) */}
            <section className="mt-8 p-6 dark-card border-2 border-blue-600 rounded-2xl shadow-md fade-in">
              <div className="flex items-start justify-between gap-4 flex-wrap mb-4">
                <div>
                  <h2 className="text-lg font-bold text-blue-300">Dead Lead Tracking</h2>
                  <p className="text-sm text-sky-700 mt-1">Assessments - Accepted = Dead Leads (handled by Agent Hybrid model)</p>
                </div>
                <div className="px-3 py-1 bg-sky-600 text-white text-xs font-bold uppercase tracking-wider rounded-full">Unique IP</div>
              </div>
              <div className="space-y-6">
                <div className="grid md:grid-cols-2 gap-6">
                  <div className="p-4 dark-card rounded-xl border border-blue-700">
                    <div className="text-xs text-sky-700 uppercase tracking-wider mb-1">Dead Leads Formula</div>
                    <div className="text-sm text-sky-700 mb-2">(Assessments /year âˆ’ Accepted /year) Ã· 12 = Dead Leads /mo</div>
                    <div className="text-lg font-bold text-blue-300">{assessments.toLocaleString()} Assessments /year</div>
                    <div className="text-sm text-sky-700">âˆ’ {funnel.accepted.toLocaleString()} Accepted /year</div>
                    <div className="text-sm text-sky-700">= {economics.deadLead.annualLeads.toLocaleString()} dead leads /year</div>
                    <div className="mt-2 pt-2 border-t border-sky-300 text-2xl font-bold text-sky-600">= {economics.deadLead.monthly.toLocaleString()} /month</div>
                    <div className="mt-1 text-xs text-sky-600">({economics.deadLead.annualLeads.toLocaleString()} Ã· 12 months)</div>
                  </div>
                  <div className="space-y-4">
                    <div>
                      <div className="text-sm text-blue-300">Conversion rate: <span className="font-bold">{(deadLeadConversionRate*100).toFixed(1)}%</span></div>
                      <input className="mt-2 w-full" type="range" min={0.005} max={0.10} step={0.005} value={deadLeadConversionRate} onChange={e=>setDeadLeadConversionRate(parseFloat(e.target.value))} />
                      <div className="mt-1 text-xs text-sky-600">{Math.round(economics.deadLead.conversions)} conversions / year via Agent Hybrid</div>
                    </div>
                    <div>
                      <div className="text-sm text-blue-300">Avg retail deal value: <span className="font-bold">{formatUSD(avgRetailDealValue)}</span></div>
                      <input className="mt-2 w-full" type="range" min={80000} max={250000} step={10000} value={avgRetailDealValue} onChange={e=>setAvgRetailDealValue(parseInt(e.target.value))} />
                      <div className="mt-1 text-xs text-sky-600">Used in Agent Hybrid revenue calculations</div>
                    </div>
                  </div>
                </div>
                <div className="p-4 dark-card rounded-xl border border-amber-700">
                  <div className="text-xs font-bold text-amber-300 mb-3">ðŸ“Š Agent Hybrid Model</div>
                  <div className="text-xs text-amber-200 leading-relaxed">
                    Dead leads are converted by <strong>{economics.licensedAgent.seats.toFixed(1)} licensed agents</strong> ({Math.round(pctAgentsLicensed*100)}% of {economics.wholesaler.totalAgents} wholesaler agents).
                    They earn <strong>50/50 commission split</strong> on retail deals. More reliable than referral fees, with better retention.
                  </div>
                </div>

                {/* Agent Outside Business - De-emphasized */}
                <div className="p-4 dark-card rounded-xl border border-neutral-600 bg-neutral-800/30">
                  <div className="text-xs font-bold text-neutral-400 mb-2">Agent Outside Business</div>
                  <div className="text-xs text-neutral-500 leading-relaxed mb-3">
                    Agents bring their own deals (not from Rebuilt funnel). Low volume but adds up with scale.
                  </div>
                  <div className="grid grid-cols-3 gap-3 text-xs">
                    <div>
                      <div className="text-neutral-400">Agent split: <span className="font-bold text-neutral-300">{Math.round(agentOutsideSplitToAgent*100)}%</span></div>
                      <input className="mt-2 w-full" type="range" min={0.50} max={0.95} step={0.05} value={agentOutsideSplitToAgent} onChange={e=>setAgentOutsideSplitToAgent(parseFloat(e.target.value))} />
                      <div className="mt-1 text-[10px] text-neutral-600">Firm: {Math.round((1-agentOutsideSplitToAgent)*100)}%</div>
                    </div>
                    <div>
                      <div className="text-neutral-400">Avg price: <span className="font-bold text-neutral-300">{formatUSD(agentOutsideAvgPrice)}</span></div>
                      <input className="mt-2 w-full" type="range" min={150000} max={400000} step={50000} value={agentOutsideAvgPrice} onChange={e=>setAgentOutsideAvgPrice(parseInt(e.target.value))} />
                      <div className="mt-1 text-[10px] text-neutral-600">~{(mlsCommissionRate*100).toFixed(1)}% comm.</div>
                    </div>
                    <div>
                      <div className="text-neutral-400">Deals/seat/yr: <span className="font-bold text-neutral-300">{agentOutsideDealsPerSeatPerYear.toFixed(1)}</span></div>
                      <input className="mt-2 w-full" type="range" min={0} max={20} step={0.5} value={agentOutsideDealsPerSeatPerYear} onChange={e=>setAgentOutsideDealsPerSeatPerYear(parseFloat(e.target.value))} />
                      <div className="mt-1 text-[10px] text-neutral-600">{economics.licensedAgent.outsideBusiness.dealsPerYear.toFixed(0)} total/yr</div>
                    </div>
                  </div>
                </div>
              </div>
              <div className="mt-4 pt-4 border-t border-sky-300 dark-card rounded-xl p-4">
                <div className="text-xs text-sky-700 mt-2"><strong>Competitive Advantage:</strong> InvestorLift admits 50% contract fallout. New Western & EasyStreetOffers have no solution. <strong>We capture this with our Agent Hybrid model.</strong></div>
              </div>
            </section>

            {/* MARKETPLACE REVENUE (Network Effects) */}
            <section className="mt-8 p-6 dark-card border-2 border-emerald-600 rounded-2xl shadow-md fade-in">
              <div className="flex items-start justify-between gap-4 flex-wrap mb-4">
                <div>
                  <h2 className="text-lg font-bold text-emerald-300">Marketplace Revenue</h2>
                  <p className="text-sm text-emerald-700 mt-1">Open aggregation â€” InvestorLift is closed, New Western/EasyStreet don't aggregate</p>
                </div>
                <div className="px-3 py-1 bg-emerald-600 text-white text-xs font-bold uppercase tracking-wider rounded-full">Network Effects</div>
              </div>
              <div className="grid md:grid-cols-2 gap-6">
                <div className="space-y-4">
                  <div>
                    <div className="text-sm text-emerald-300">Third-party wholesalers: <span className="font-bold">{thirdPartyWholesalers.toLocaleString()}</span></div>
                    <input className="mt-2 w-full" type="range" min={10} max={500} step={10} value={thirdPartyWholesalers} onChange={e=>setThirdPartyWholesalers(parseInt(e.target.value))} />
                  </div>
                  <div>
                    <div className="text-sm text-emerald-300">Avg deals / wholesaler / month: <span className="font-bold">{avgDealsPerWholesaler.toFixed(1)}</span></div>
                    <input className="mt-2 w-full" type="range" min={0.5} max={10} step={0.5} value={avgDealsPerWholesaler} onChange={e=>setAvgDealsPerWholesaler(parseFloat(e.target.value))} />
                    <div className="mt-1 text-xs text-emerald-600">{economics.marketplace.dealsAnnual.toLocaleString()} marketplace deals / year</div>
                  </div>
                </div>
                <div className="space-y-4">
                  <div>
                    <div className="text-sm text-emerald-300">Avg wholesale deal value: <span className="font-bold">{formatUSD(avgWholesaleDealValue)}</span></div>
                    <input className="mt-2 w-full" type="range" min={10000} max={100000} step={5000} value={avgWholesaleDealValue} onChange={e=>setAvgWholesaleDealValue(parseInt(e.target.value))} />
                  </div>
                  <div>
                    <div className="text-sm text-emerald-300">Platform fee rate: <span className="font-bold">{(marketplaceFeeRate*100).toFixed(2)}%</span></div>
                    <input className="mt-2 w-full" type="range" min={0.0025} max={0.01} step={0.0025} value={marketplaceFeeRate} onChange={e=>setMarketplaceFeeRate(parseFloat(e.target.value))} />
                    <div className="mt-1 text-xs text-emerald-600">Range: 0.25% - 1.0% (base 0.5%)</div>
                  </div>
                  <div>
                    <div className="text-sm text-emerald-300">Minimum fee: <span className="font-bold">{formatUSD(marketplaceMinFee)}</span></div>
                    <input className="mt-2 w-full" type="range" min={100} max={300} step={25} value={marketplaceMinFee} onChange={e=>setMarketplaceMinFee(parseInt(e.target.value))} />
                    <div className="mt-1 text-xs text-emerald-600">Actual fee: {formatUSD(economics.marketplace.feePerDeal)} (higher of % or min)</div>
                  </div>
                </div>
              </div>
              <div className="mt-4 pt-4 border-t border-emerald-300 dark-card rounded-xl p-4">
                <div className="text-sm font-bold text-emerald-300">Annual Marketplace Revenue: <span className="text-2xl text-emerald-600">{formatUSD(economics.rounded.marketplaceRevenue)}</span></div>
                <div className="text-xs text-emerald-700 mt-2">Asset-light model. More wholesalers â†’ more deals â†’ more buyers â†’ more wholesalers (network effects). <strong>Enforcement:</strong> Invoice + honor system (Signing Tool integration optional for tracking).</div>
              </div>
            </section>

            {/* PLATFORM SAAS (Signing + Rehab AI + ARV AI) */}
            <section className="mt-8 p-6 dark-card border-2 border-purple-600 rounded-2xl shadow-md fade-in">
              <div className="flex items-start justify-between gap-4 flex-wrap mb-4">
                <div>
                  <h2 className="text-lg font-bold text-purple-300">Platform SaaS</h2>
                  <p className="text-sm text-purple-700 mt-1">Signing Tool + Rehab AI Budgeteer + ARV AI Valuations</p>
                </div>
                <div className="px-3 py-1 bg-purple-600 text-white text-xs font-bold uppercase tracking-wider rounded-full">Recurring Revenue</div>
              </div>
              <div className="grid md:grid-cols-2 gap-6">
                <div className="space-y-4">
                  <div>
                    <div className="text-sm text-purple-300">Active users: <span className="font-bold">{saasActiveUsers.toLocaleString()}</span></div>
                    <input className="mt-2 w-full" type="range" min={0} max={1000} step={10} value={saasActiveUsers} onChange={e=>setSaasActiveUsers(parseInt(e.target.value))} />
                    <div className="mt-1 text-xs text-purple-600">Free for first 2 months, then $10/mo base</div>
                  </div>
                  <div>
                    <div className="text-sm text-purple-300">Base fee / month: <span className="font-bold">{formatUSD(saasBaseFee)}</span></div>
                    <input className="mt-2 w-full" type="range" min={5} max={20} step={1} value={saasBaseFee} onChange={e=>setSaasBaseFee(parseInt(e.target.value))} />
                    <div className="mt-1 text-xs text-purple-600">MRR from base: {formatUSD(saasActiveUsers * saasBaseFee)}</div>
                  </div>
                </div>
                <div className="space-y-4">
                  <div>
                    <div className="text-sm text-purple-300">Envelopes / month: <span className="font-bold">{saasEnvelopes.toLocaleString()}</span></div>
                    <input className="mt-2 w-full" type="range" min={0} max={2000} step={50} value={saasEnvelopes} onChange={e=>setSaasEnvelopes(parseInt(e.target.value))} />
                    <div className="mt-1 text-xs text-purple-600">Optional signing service at $2/envelope</div>
                  </div>
                  <div>
                    <div className="text-sm text-purple-300">Envelope fee: <span className="font-bold">{formatUSD(saasEnvelopeFee)}</span></div>
                    <input className="mt-2 w-full" type="range" min={1} max={5} step={0.5} value={saasEnvelopeFee} onChange={e=>setSaasEnvelopeFee(parseFloat(e.target.value))} />
                    <div className="mt-1 text-xs text-purple-600">Free if >5 txns/year, MRR: {formatUSD(saasEnvelopes * saasEnvelopeFee)}</div>
                  </div>
                </div>
              </div>
              <div className="mt-4 pt-4 border-t border-purple-300">
                <h3 className="text-sm font-bold text-purple-300 mb-3">AI Tools Pricing (5 free each/month, then paid)</h3>
                <div className="grid md:grid-cols-2 gap-4 mb-4">
                  <div className="p-3 dark-card rounded-xl">
                    <div className="text-xs text-purple-700 uppercase tracking-wider mb-2">Rehab AI Budgeteer</div>
                    <div>
                      <div className="text-sm text-purple-300">Paid uses/mo: <span className="font-bold">{rehabAIUsesPerMonth}</span></div>
                      <input className="mt-1 w-full" type="range" min={0} max={500} step={10} value={rehabAIUsesPerMonth} onChange={e=>setRehabAIUsesPerMonth(parseInt(e.target.value))} />
                    </div>
                    <div className="mt-2">
                      <div className="text-sm text-purple-300">Fee/use: <span className="font-bold">{formatUSD(rehabAIFeePerUse)}</span></div>
                      <input className="mt-1 w-full" type="range" min={0.25} max={10} step={0.25} value={rehabAIFeePerUse} onChange={e=>setRehabAIFeePerUse(parseFloat(e.target.value))} />
                    </div>
                    <div className="mt-2 pt-2 border-t border-purple-200 text-xs text-purple-700">Annual: <span className="font-bold text-purple-300">{formatUSD(economics.platformSaaS.rehabAIRevenue)}</span></div>
                  </div>
                  <div className="p-3 dark-card rounded-xl">
                    <div className="text-xs text-purple-700 uppercase tracking-wider mb-2">ARV AI Valuations</div>
                    <div>
                      <div className="text-sm text-purple-300">Paid uses/mo: <span className="font-bold">{arvAIUsesPerMonth}</span></div>
                      <input className="mt-1 w-full" type="range" min={0} max={500} step={10} value={arvAIUsesPerMonth} onChange={e=>setArvAIUsesPerMonth(parseInt(e.target.value))} />
                    </div>
                    <div className="mt-2">
                      <div className="text-sm text-purple-300">Fee/use: <span className="font-bold">{formatUSD(arvAIFeePerUse)}</span></div>
                      <input className="mt-1 w-full" type="range" min={0.25} max={10} step={0.25} value={arvAIFeePerUse} onChange={e=>setArvAIFeePerUse(parseFloat(e.target.value))} />
                    </div>
                    <div className="mt-2 pt-2 border-t border-purple-200 text-xs text-purple-700">Annual: <span className="font-bold text-purple-300">{formatUSD(economics.platformSaaS.arvAIRevenue)}</span></div>
                  </div>
                </div>
                <div className="text-xs text-purple-600 mb-4">Note: $10/mo users OR 5+ txns/year users get 50/mo free uses (no extra charge). Free tier: 5 uses/mo each tool.</div>
              </div>
              <div className="mt-4 pt-4 border-t border-purple-300">
                <div className="grid md:grid-cols-3 gap-4">
                  <div className="p-3 dark-card rounded-xl">
                    <div className="text-xs text-purple-700 uppercase tracking-wider mb-2">Title SaaS (Platform)</div>
                    <div>
                      <div className="text-sm text-purple-300">Profit/deal: <span className="font-bold">{formatUSD(titleSaasProfitPerDeal)}</span></div>
                      <input className="mt-1 w-full" type="range" min={200} max={800} step={25} value={titleSaasProfitPerDeal} onChange={e=>setTitleSaasProfitPerDeal(parseInt(e.target.value))} />
                    </div>
                    <div className="mt-2">
                      <div className="text-sm text-purple-300">Transaction %: <span className="font-bold">{Math.round(titleSaasTransactionRate*100)}%</span></div>
                      <input className="mt-1 w-full" type="range" min={0.05} max={0.50} step={0.05} value={titleSaasTransactionRate} onChange={e=>setTitleSaasTransactionRate(parseFloat(e.target.value))} />
                    </div>
                    <div className="mt-2 pt-2 border-t border-purple-200 text-lg font-bold text-purple-300">{formatUSD(economics.platformSaaS.titleSaasProfit)}</div>
                  </div>
                  <div className="p-3 dark-card rounded-xl">
                    <div className="text-xs text-purple-700 uppercase tracking-wider mb-1">Lead Sales (de-emphasized)</div>
                    <div className="text-sm text-purple-300 mb-1">Units: <span className="font-bold">{leadSalesUnits}</span> @ {formatUSD(leadSalesPrice)}</div>
                    <div className="flex gap-2">
                      <input className="w-20 px-2 py-1 border border-purple-300 rounded text-xs" type="number" min={0} max={500} value={leadSalesUnits} onChange={e=>setLeadSalesUnits(parseInt(e.target.value)||0)} />
                      <input className="w-20 px-2 py-1 border border-purple-300 rounded text-xs" type="number" min={0} max={100} value={leadSalesPrice} onChange={e=>setLeadSalesPrice(parseInt(e.target.value)||0)} />
                    </div>
                    <div className="text-xs text-purple-600 mt-1">Annual: {formatUSD(economics.platformSaaS.leadSalesRevenue)}</div>
                  </div>
                  <div className="p-3 dark-card rounded-xl border border-purple-700">
                    <div className="text-xs text-purple-700 uppercase tracking-wider mb-1">Total Platform SaaS</div>
                    <div className="text-2xl font-bold text-purple-600">{formatUSD(economics.rounded.platformSaasTotal)}</div>
                    <div className="text-xs text-purple-700 mt-1">MRR: {formatUSD(economics.platformSaaS.mrr)}</div>
                  </div>
                </div>
              </div>
              <div className="mt-4 pt-4 border-t border-purple-300 dark-card rounded-xl p-4">
                <div className="text-xs text-purple-700"><strong>Note:</strong> Signing Tool not yet live. Title SaaS captures 20% of marketplace + agent deals (lower than Rebuilt direct 90%). Lead Sales sells "warm" leads to RE agents (not a focus).</div>
              </div>
            </section>

            {/* Net Summary */}
            <section className="mt-8 grid gap-6 md:grid-cols-1">
              <div className="p-6 dark-card border-2 border-blue-600 rounded-2xl shadow-lg">
                <div className="flex flex-wrap items-end justify-between gap-6">
                  <div title="Gross âˆ’ Infrastructure âˆ’ Agent Cost" className="pulsing">
                    <div className="uppercase text-xs tracking-[0.35em] text-neutral-400">Adjusted Annual Gross</div>
                    <div className="mt-2 text-4xl font-bold tracking-tight text-blue-400">{formatUSD(economics.rounded.net)}</div>
                  </div>
                  <div className="text-xs text-right text-neutral-400 leading-relaxed">
                    <div title="Sum of all revenue streams below">Gross: <span className="text-neutral-100">{formatUSD(economics.rounded.gross)}</span></div>
                    <div title="Markets Ã— $2,500/mo Ã— 12">Infra cost: <span className="text-neutral-100">{formatUSD(economics.infra)}</span></div>
                    <div title="Wholesaler (fixed + variable) + Licensed agent splits">Agent cost: <span className="text-neutral-100">{formatUSD(economics.totalAgentCost)}</span></div>
                  </div>
                </div>
                <div className="mt-5 border-t border-white/40 pt-4">
                  <div className="text-[10px] uppercase tracking-[0.3em] opacity-80">Contribution mix</div>
                  <div className="mt-4 space-y-4">
                    {netSegments.map((segment, idx)=>{
                      const display = formatUSD(segment.magnitude);
                      let barShade;
                      if (segment.highlight && segment.tone === "positive") {
                        // Special golden glow for unique revenue streams
                        barShade = `linear-gradient(90deg, rgba(251,191,36,0.95) 0%, rgba(245,158,11,${0.7 + segment.scale*0.3}) 100%)`;
                      } else if (segment.tone === "positive") {
                        barShade = `linear-gradient(90deg, rgba(96,165,250,0.9) 0%, rgba(59,130,246,${0.6 + segment.scale*0.3}) 100%)`;
                      } else {
                        barShade = `linear-gradient(90deg, rgba(239,68,68,0.6) 0%, rgba(220,38,38,${0.7 + segment.scale*0.2}) 100%)`;
                      }
                      // Add divider before first expense item
                      const showDivider = idx > 0 && segment.tone === "negative" && netSegments[idx-1].tone === "positive";
                      // Generate formula for tooltip
                      let formula = '';
                      switch(segment.key) {
                        case 'offMarket':
                          formula = `${economics.offMktAnnual} deals Ã— ${Math.round(offMarketCapture*100)}% capture Ã— $${offMarketFee.toLocaleString()}`;
                          break;
                        case 'mls':
                          formula = `${economics.mlsAnnual} deals Ã— $${mlsAvgPrice.toLocaleString()} Ã— ${(mlsCommissionRate*100).toFixed(1)}%`;
                          break;
                        case 'titleDirect':
                          formula = `${economics.offMktAnnual} off-mkt Ã— ${Math.round(titleDirectCaptureRate*100)}% Ã— $${titleProfitPerDeal}`;
                          break;
                        case 'agentRevenue':
                          formula = `Dead leads: ${Math.round(economics.deadLead.conversions)} conversions + Outside: ${economics.licensedAgent.outsideBusiness.dealsPerYear.toFixed(0)} deals`;
                          break;
                        case 'marketplace':
                          formula = `${thirdPartyWholesalers} wholesalers Ã— ${avgDealsPerWholesaler} deals/mo Ã— 12 Ã— $${economics.marketplace.feePerDeal.toLocaleString()}`;
                          break;
                        case 'platformSaaS':
                          formula = `Base: $${(saasActiveUsers*saasBaseFee*12).toLocaleString()} + Envelopes + AI Tools + Title SaaS`;
                          break;
                        case 'infra':
                          formula = `${economics.licensedAgent.totalMarkets} markets Ã— $${infraPerMarketPerMonth.toLocaleString()}/mo Ã— 12`;
                          break;
                        case 'agentCost':
                          formula = `${economics.wholesaler.totalAgents} wholesaler agents + ${economics.licensedAgent.seats.toFixed(1)} licensed (${Math.round(pctAgentsLicensed*100)}%)`;
                          break;
                      }
                      return (
                        <React.Fragment key={segment.key}>
                          {showDivider && <div className="my-3 border-t border-neutral-600 pt-2"></div>}
                          <div className="has-tooltip relative p-2 rounded-lg transition-all duration-200 hover:bg-neutral-700/50 hover:scale-[1.02]">
                            <div className="flex items-center justify-between text-xs font-semibold tracking-wide text-neutral-200">
                              <span className={segment.highlight ? "flex items-center gap-1" : ""}>
                                {segment.label}
                                {segment.highlight && <span className="text-[9px] px-1.5 py-0.5 bg-amber-400 text-amber-900 rounded-full font-extrabold">â˜…</span>}
                              </span>
                              <span className="text-neutral-100">{segment.tone === "negative" ? "â€“" : ""}{display}</span>
                            </div>
                            <div className="mt-2 h-3 w-full rounded-full bg-neutral-800 overflow-hidden border border-neutral-700">
                              <div
                                className="h-full bar-animate"
                                style={{ '--target-width': `${segment.widthPct}%`, background: barShade }}
                                aria-hidden="true"
                              />
                            </div>
                            <div className="tooltip-enhanced">
                              <strong>{segment.label}: {display}</strong><br/>
                              {formula}<br/>
                              <span className="text-neutral-400 text-[10px]">{((segment.magnitude / Math.abs(economics.rounded.gross)) * 100).toFixed(1)}% of Gross</span>
                            </div>
                          </div>
                        </React.Fragment>
                      );
                    })}
                  </div>
                </div>
              </div>
            </section>

            {/* Real Estate Investment Facts */}
            <section className="mt-10 p-6 dark-card rounded-2xl border border-neutral-700">
              <h3 className="text-lg font-bold text-neutral-200 mb-4">Real Estate Investment Insights</h3>
              <div className="grid md:grid-cols-3 gap-4">
                <div className="p-4 dark-card rounded-xl border border-neutral-700">
                  <div className="text-3xl font-bold text-emerald-600 mb-2">47%</div>
                  <div className="text-sm text-neutral-300">New Western agent annual churn rate â€” middle-tier agents need better support and retention models</div>
                </div>
                <div className="p-4 dark-card rounded-xl border border-neutral-700">
                  <div className="text-3xl font-bold text-sky-600 mb-2">50%</div>
                  <div className="text-sm text-neutral-300">InvestorLift contract fallout rate â€” dead leads represent massive untapped opportunity for retail exits</div>
                </div>
                <div className="p-4 dark-card rounded-xl border border-neutral-700">
                  <div className="text-3xl font-bold text-amber-600 mb-2">3-5%</div>
                  <div className="text-sm text-neutral-300">Typical wholesale close rate from assessments â€” multiple exit strategies maximize property monetization</div>
                </div>
                <div className="p-4 dark-card rounded-xl border border-neutral-700">
                  <div className="text-3xl font-bold text-purple-600 mb-2">$400</div>
                  <div className="text-sm text-neutral-300">Average title profit per transaction â€” ancillary services compound revenue without marginal acquisition cost</div>
                </div>
                <div className="p-4 dark-card rounded-xl border border-neutral-700">
                  <div className="text-3xl font-bold text-rose-600 mb-2">14%</div>
                  <div className="text-sm text-neutral-300">Properties purchased sight-unseen by investors â€” AI-powered valuations reduce friction and accelerate decisions</div>
                </div>
                <div className="p-4 dark-card rounded-xl border border-neutral-700">
                  <div className="text-3xl font-bold text-teal-600 mb-2">$30K</div>
                  <div className="text-sm text-neutral-300">Average wholesale deal value â€” low transaction sizes favor platform fee models over commission structures</div>
                </div>
              </div>
              <div className="mt-6 p-4 dark-card border border-blue-700 rounded-xl">
                <div className="text-xs font-bold text-blue-300 mb-2">ðŸ’¡ Strategic Insight</div>
                <div className="text-sm text-blue-200 leading-relaxed">
                  The off-market real estate industry suffers from <strong>single-exit thinking</strong>. By building multiple monetization pathways (wholesale, retail, marketplace aggregation, platform tools), Rebuilt captures value competitors leave on the table while improving outcomes for buyers, sellers, and agents.
                </div>
              </div>
            </section>

          </main>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
  </script>
</body>
</html>
